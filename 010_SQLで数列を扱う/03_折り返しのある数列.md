# 折り返しのある数列
|seat|line_id|status|
|:----|:----|:----|
|1|A|占|
|2|A|占|
|3|A|空|
|4|A|空|
|5|A|空|
|6|B|占|
|7|B|占|
|8|B|空|
|9|B|空|
|10|B|空|
|11|C|空|
|12|C|空|
|13|C|空|
|14|C|占|
|15|C|空|

Q. 1~15の座席から3人で連続した席が予約できるかを求める  
{9,10,11}は列が折り返されているため、選択してはいけない  
- NOT EXISTS
``` sql
DECLARE @head_cnt int = 3;
SELECT
	s1.seat AS 'start_seat'
	,'~'
	,s2.seat AS 'end_seat'
FROM
	Chapter10Seats2 AS s1
CROSS JOIN
	Chapter10Seats2 AS s2
WHERE
	s2.seat = s1.seat + (@head_cnt - 1)
AND
	NOT EXISTS(
		SELECT * FROM Chapter10Seats2 AS s3
		WHERE
			s1.seat <= s3.seat
		AND
			s3.seat <= s2.seat
		AND
			(s3.status <> '空'
		OR
			 s1.line_id <> s3.line_id)
	)

-- result
start_seat	(列名なし)	end_seat
3	~	5
8	~	10
11	~	13
```

考え方は以下である  
