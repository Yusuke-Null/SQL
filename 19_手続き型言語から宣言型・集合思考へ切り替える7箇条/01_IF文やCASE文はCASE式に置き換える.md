# はじめに
SQLの考え方を習得する最大の障壁は手続き型言語の考え方である  
-> 代入、分岐、ループを基本的な処理単位として、システム全体をこの基本的な処理へ分割する発想  
SQLの考え方はある意味対極にある  
-> 代入やループなどの手続きは一切なく、データもレコードでなく、もっと複合的な集合単位で扱われる  
そのため、無理に手続き的に組もうとすると長大で複雑なSQLになるか、安易にプロシージャとカーソルに手を出して  
手続き型の世界へ戻ることになる。ウィンドウ関数の登場にってSQLでも手続き型の考え方が輸入されつつも  
ベースには宣言型・集合指向的な考え方があることに変わりはない  
よって、SQLの習熟にはSQLとRDBの世界を支配する独自の原理を理解し、使いこなさなければならない  


## 1.IF文やCASE文はCASE式に置き換える
手続き型言語では処理の分岐は「文」の単位で行うが、SQLでは文中の「式」の単位で分岐させる  
SQLでも1つのSELECTやUPDATE文の中で手続き型言語と同様の複雑で柔軟な分岐を表現することは可能だが  
その為に威力を発揮するのがCASE式である  
CASE「文」でなく、CASE「式」であるため、実行時には1つの値に評価される  
そのため、定数や1+1が書ける場所ならどこにも書くことができ、1つの値に定まることから  
他の式や関数を引数に取ることができる  
**また、入力に対して1つの値を返す点ではCASE式は一種の関数である**  
条件を入れ子にできるため、階層型な分岐もできる点が関数型の言語と同じ
``` Lisp
-- Lispとは関数型言語
cond(
  ((= x 1) 'xは1です')
    ((= x 2) 'xは2です')
      (t 'xは1です'))
```
-- sql
CASE WHEN x = 1 THEN 'xは1です'
  WHEN x = 2 THEN 'xは2です'
  ELSE 'xはそれ以外です'
END
```

## 2.ループはGROUP BY句やウィンドウ関数で置き換える
