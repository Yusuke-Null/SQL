# コラム_ランキング
``` sql
SELECT
	name
	,price
	,RANK() OVER (ORDER BY price DESC) as prce_rank
	,DENSE_RANK() OVER (ORDER BY price DESC) as prce_rank2
FROM
	Chapter3Products

-- result
name	price	prce_rank	prce_rank2
みかん	100	1	1
バナナ	100	1	1
いちご	100	1	1
スイカ	80	4	2
ぶどう	50	5	3
りんご	50	5	3
レモン	30	7	4
```
ウィンドウ関数でランキングは作れるが、なかった時代はself joinで作る必要があった
``` sql
-- 相関サブクエリ
SELECT
	p1.name
	,p1.price
	,(SELECT COUNT(p2.price)
		FROM Chapter3Products p2
		WHERE p1.price < p2.price) + 1 as price_rank
FROM
	Chapter3Products p1
ORDER BY
	p1.price DESC

-- self join
SELECT
	p1.name
	,MAX(p1.price) as price
	,COUNT(p2.name) + 1 as rank_1
FROM
	Chapter3Products p1
LEFT JOIN
	Chapter3Products p2
ON
	p1.price < p2.price
GROUP BY
	p1.name
ORDER BY
	price DESC

-- result
name	price	price_rank
みかん	100	1
バナナ	100	1
いちご	100	1
スイカ	80	4
ぶどう	50	5
りんご	50	5
レモン	30	7

SELECT
	p1.name
	,p1.price
	,(SELECT COUNT(DISTINCT p2.price)
		FROM Chapter3Products p2
		WHERE p1.price < p2.price) + 1 as price_rank
FROM
	Chapter3Products p1
ORDER BY
	p1.price DESC

-- result
name	price	price_rank
みかん	100	1
バナナ	100	1
いちご	100	1
スイカ	80	2
ぶどう	50	3
りんご	50	3
レモン	30	4
```
