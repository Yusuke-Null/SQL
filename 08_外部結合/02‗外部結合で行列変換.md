# 外部結合で行列変換
## 外部結合行列変換2: 列->行-繰り返し項目を1列にまとめる
こういったテーブルは行持ちに変換するのが基本
|employee|child1|child2|child3|
|:----|:----|:----|:----|
|赤井|一郎|二郎|三郎|
|工藤|春子|夏子|NULL|
|鈴木|夏子|NULL|NULL|
|吉田|NULL|NULL|NULL|

UNION ALL
``` sql
SELECT
	employee
	,child1 AS child	
FROM
	Chpater8Personnel
UNION ALL
SELECT
	employee
	,child2 AS child
FROM
	Chpater8Personnel
UNION ALL
SELECT
	employee
	,child3 AS child
FROM
	Chapter8Personnel
ORDER BY
	employee

-- result
employee	child
吉田	NULL
吉田	NULL
吉田	NULL
工藤	NULL
工藤	夏子
工藤	春子
赤井	二郎
赤井	三郎
赤井	一郎
鈴木	NULL
鈴木	NULL
鈴木	夏子
```
単に複数の SELECT 結果を「重複を除かずに」結合するだけで、フィルタリング機能は持たない  
->子供がいない吉田も3行出力されている  
各SELECT文に対してchildX IS NOT NULLを指定しないといけない  
※ 最後にWHERE child IS NOT NULLとしてもSQL Serverではエラーになる  
よって単純にNULLで行を除外できないため子供一覧を保持するビュー(子供マスタ)を作る
|child|
|:----|
|NULL|
|一郎|
|夏子|
|三郎|
|春子|
|二郎|
``` sql
CREATE VIEW Chapter8Children(child)
AS
	SELECT child1 FROM Chpater8Personnel
	UNION
	SELECT child2 FROM Chpater8Personnel
	UNION
	SELECT child3 FROM Chpater8Personnel
```
上記のビューと外部結合する
``` sql
SELECT
	emp.employee
	,children.child
FROM
	Chapter8Personnel AS emp
LEFT JOIN
	Chapter8Children AS children
ON
	children.child IN(emp.child1,emp.child2,emp.child3)
WHERE
	children.child IS NOT NULL
ORDER BY
	emp.employee

-- result
employee	child
工藤	夏子
工藤	春子
赤井	二郎
赤井	一郎
赤井	三郎
鈴木	夏子
```
