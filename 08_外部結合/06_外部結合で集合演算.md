# 外部結合で集合演算
結合は集合演算とみなすことができ、完全外部結合(UNION)は和集合であり、内部結合は積集合である  
情報が欠落しないという点ではUNIONと外部結合は似ている  

## 左(右)外部結合で差集合を求める
### 外部結合で差集合を求める: A-B
UNIONのような集合演算子はパフォーマンスの影響があるため、集合演算子の代用案をマスターしておくことは有用  
先のClass_AとClass_Bの外部結合クエリでは、Aに存在しないまたはBに存在しない値はNULLとなっていた  
-> 結合結果に対してNULLの条件を設定することで差集合を求められる  
下記はAクラスに存在し、Bクラスには存在しない人を求める
``` sql
SELECT
	a.id AS id
	,a.name AS a_name 
	,b.name AS b_name
FROM
	Chapter8Class_A AS a
LEFT JOIN
	Chapter8Class_B AS b
ON
	a.id = b.id
WHERE
	b.name IS NULL

--result
id	a_name	b_name
3	伊集院	NULL
```
### 外部結合で差集合を求める: B-A
前述の反対でBクラスに存在し、Aクラスに孫座しない人を求める  
(BをFROM句に持ってきて、LEFTJOINでもOK)
``` sql
SELECT
	a.id AS id
	,a.name AS a_name 
	,b.name AS b_name
FROM
	Chapter8Class_A AS a
RIGHT JOIN
	Chapter8Class_B AS b
ON
	a.id = b.id
WHERE
	a.name IS NULL

-- result
id	a_name	b_name
NULL	NULL	西園寺
```
外部結合の使い方としては正道ではないが、差集合演算を持っていない実装の場合には  
NOT INやNOT EXISTSと並んで現実的な選択肢である(差集合演算の中では最速の動作である可能性が高いため)

## 完全外部結合で排他的和集合を求める
集合Aと集合Bの排他的和集合を求める演算子がSQLにはない  
集合演算子を使うなら以下どちらかになるが、面倒かつパフォーマンスが悪い
``` sql
-- AとBの和集合からAとBの積集合を除く
(A UNION B) EXCEPT(A INTERSECT B)
-- AからBを除いたものとBからAを除いたものを合わせる
(A EXCEPT B) UNION(B EXCEPT A)
```
完全外部結合のNULLの条件を設定すれば求められる
``` sql
SELECT
	COALESCE(a.id,b.id) AS id
	,COALESCE(a.name,b.name) AS name 
FROM
	Chapter8Class_A AS a
FULL JOIN
	Chapter8Class_B AS b
ON
	a.id = b.id
WHERE
	a.name IS NULL
OR
	b.name IS NULL

-- result
id	name
3	伊集院
4	西園寺
```
