# ウィンドウ関数行間比較
同じ行で異なる列同士を比較する場合は「col1 = col2」でよいが、異なる行の別カラムを比較はそれではできない  
-> ウィンドウ関数を使うとできる(サブクエリでもできるが、煩雑かつパフォーマンスがよくない)  
行間比較が必要になるケースとしては経年分析が代表例である  
|fisical_year|sale|
|:----|:----|
|1990-01-01|50|
|1991-01-01|51|
|1992-01-01|52|
|1993-01-01|52|
|1994-01-01|50|
|1995-01-01|50|
|1996-01-01|49|
|1997-01-01|55|

EX) 前年と年商が同じ年度を求める  
前年のレコードを保持するテーブルを追加し、相関サブクエリで求める  
-> ファイルで言うと1行ずつずらしてループの代役をしていることから  
相関サブクエリはループクエリとも呼ばれる
``` sql
SELECT fisical_year,sale FROM Chapter7Sales as s1
WHERE
	sale = (
		SELECT sale FROM Chapter7Sales as s2
		WHERE
			DATEADD(year,-1,s1.fisical_year)  = s2.fisical_year)

-- result
fisical_year	sale
1993-01-01	52
1995-01-01	50
```
ウィンドウ関数で上記と同じデータを求める  
カレントレコードを基点として行の集計範囲を制限するウィンドウ関数の機能をフレーム句という
``` sql
SELECT fisical_year,current_sale 
FROM
	(SELECT
		fisical_year
		,sale AS current_sale
		,SUM(sale) OVER (
			ORDER BY fisical_year
			ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING) AS pre_sale
	 FROM
		Chapter7Sales) AS tmp
WHERE
	current_sale = pre_sale
ORDER BY
	fisical_year

-- result
fisical_year	current_sale
1993-01-01	52
1995-01-01	50
```
通常使用のSUMなどと違ってレコードを集約しない点がウィンドウ関数のポイント  
-> あくまで新たな列を追加して表示しているにすぎない
EX) 前年に比べて年商が増減したか、変わらなかったのかを求める  
