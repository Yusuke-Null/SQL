# ウィンドウ関数_歯抜け
下記のような年度が歯抜けのテーブルでは、当年度-1という条件では出力できなくなる  
-> 直近の行を比較対象にしないといけない
|fisical_year|sale|
|:----|:----|
|1990-01-01|50|
|1992-01-01|50|
|1993-01-01|52|
|1994-01-01|55|
|1997-01-01|55|

EX) 直近の年商と同じ年度を求める
相関サブクエリでは以下の条件を満たす必要がある
1. 自分より前の年であること
2. 1を満たす中で最大年度であること
``` sql
SELECT fisical_year,sale
FROM
	Chapter7Sales2 AS s1
WHERE
	sale = (
		SELECT
			sale
		FROM
			Chapter7Sales2 AS s2
		WHERE
			s2.fisical_year = (
				SELECT
					MAX(fisical_year)
				FROM
					Chapter7Sales2 AS s3
				WHERE
					s3.fisical_year < s1.fisical_year))

-- result
fisical_year	sale
1992-01-01	50
1997-01-01	55
```
ウィンドウ関数で書くと以下になる
``` sql
SELECT
	fisical_year
	,current_sale
FROM
	(SELECT
		fisical_year
		,sale AS current_sale
		,SUM(sale) OVER (ORDER BY fisical_year
			ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING) AS pre_sale
	 FROM
		Chapter7Sales2) AS tmp
WHERE
	current_sale = pre_sale
ORDER BY
	fisical_year

-- result
fisical_year	current_sale
1992-01-01	50
1997-01-01	55
```
