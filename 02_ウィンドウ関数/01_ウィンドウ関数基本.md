# ウィンドウ関数
> Copilotの説明
> ウィンドウ関数（Window Function）とは、SQLで行ごとの集計や順位付けを、グループ化せずに柔軟に行える関数のことです。  
> GROUP BY と違って、元の行を保持したまま集計や分析ができるのが最大の特徴です。  
> ・OVER() 句を使って、どの範囲（ウィンドウ）で集計するかを指定する  
> ・GROUP BY のように行をまとめず、各行に対して集計結果を付加する  
> ・順位付けや移動平均、前後比較など、分析系の処理に強い  

下記はサンプルであり、item_typeの全体平均を各行に出力するクエリでGROUP BYのように行が集約されない  
また、SQL ServerではエラーになるがWindow関数に名前を付けることができる
``` SQL
SELECT
	id
	,item_name
	,item_type
	,unit_price
	,AVG(unit_price) OVER (
		PARTITION BY item_type) as avg_price
FROM
	Chapter2Items

-- SQL ServerではNG
SELECT
	id
	,item_name
	,item_type
	,unit_price
	,AVG(unit_price) OVER W as avg_price
FROM
	Chapter2Items
WINDOW W AS (
		PARTITION BY item_type)

-- 結果
id	item_name	item_type	unit_price	avg_price
1	IPhone	Smart phone	200	133
3	Android	Smart phone	150	133
5	Google Phone	Smart phone	50	133
6	Google Pixel Tablet	Tablet	300	166
4	Galaxy Tab	Tablet	100	166
2	IPad	Tablet	100	166
```

## 主な機能
1. PARTITION BYによるレコード集合のカット = レコードを集約しないGROUP BYのようなもの
2. ORDER BYによるレコードの順序付け = **行を順番に並べた上で、最初の行から現在行までのみを集計の対象にする**
3. フレームによるカレントレコードを中心としたサブセットの定義 -> カーソル(カレント行の位置)をSQLに持ち込み、カレントレコードを中心としたレコード集合の範囲を定義できる  
└ カレントレコードを基準とした統計指標の算出ができたり、異なる行を自分の行に持ってくるという行間比較が可能となる 
