# 一意集合と多重集合
RDBで扱われる集合は重複値を許す多重集合である  
通常の集合論では承服を認めない一意集合が一般的(造語)  
一意制約で重複の芽を詰めればいいが、要件として重複が生じることはある
|center|receive_date|material|
|:----|:----|:----|
|東京|2018-04-01|錫|
|東京|2018-04-12|亜鉛|
|東京|2018-05-17|アルミニウム|
|東京|2018-05-20|亜鉛|
|大阪|2018-04-20|銅|
|大阪|2018-04-22|ニッケル|
|大阪|2018-04-29|鉛|
|名古屋|2018-03-15|チタン|
|名古屋|2018-04-01|炭素鋼|
|名古屋|2018-04-24|炭素鋼|
|名古屋|2018-05-02|マグネシウム|
|名古屋|2018-05-10|チタン|
|福岡|2018-05-10|亜鉛|
|福岡|2018-05-28|錫|

上記のような拠点にある資材を管理するテーブルがあるとする  
経典同士の余った資材の調整のためにダブりがある拠点を調べたい  
拠点は複数行存在するため、要素ではなく、集合として存在している  
-> 重複を排除して数えた要素数が排除せずに数えた要素数と異なる  
``` sql
SELECT center FROM Chpater6Materials
GROUP BY
	center
HAVING
	COUNT(material) <> COUNT(DISTINCT(material))

-- result
center
東京
名古屋
```
CASEを使って一覧にすることもできる
``` sql
SELECT
	center
	,CASE
		WHEN COUNT(material) <> COUNT(DISTINCT(material)) THEN '重複あり'
		ELSE '重複なし'
	END
FROM
	Chpater6Materials
GROUP BY
	center

-- result
center	(列名なし)
大阪	重複なし
東京	重複あり
福岡	重複なし
名古屋	重複あり
```
EXISTSへの書き換えは以下になる
``` sql
SELECT
	center
	,material
FROM
	Chapter6Materials as m1
WHERE
	EXISTS(
		SELECT * FROM Chapter6Materials as m2
		WHERE
			m1.center = m2.center
		AND
			m1.receive_date <> m2.receive_date
		AND
			m1.material = m2.material)
ORDER BY
	m1.center
	,m1.material

-- result
center	material
東京	亜鉛
東京	亜鉛
名古屋	チタン
名古屋	チタン
名古屋	炭素鋼
名古屋	炭素鋼
