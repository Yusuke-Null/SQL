# 関係除算でバスケット解析
バスケット解析とはマーケティン分野で用いられる解析手法の1つで  
頻繁に一緒に買われる商品の法則性を見つけるものである

商品マスタ
|item|
|:----|
|ビール|
|紙おむつ|
|自転車|

店舗ごとの在庫状況テーブル
|shop|item|
|:----|:----|
|仙台|ビール|
|仙台|紙おむつ|
|仙台|自転車|
|仙台|カーテン|
|東京|ビール|
|東京|紙おむつ|
|東京|自転車|
|大阪|テレビ|
|大阪|紙おむつ|
|大阪|自転車|


EX) 商品マスタの全商品をそろえた店舗を選択する  
WHERE句でINやORで条件指定しても1行について適用されるため、正しい結果は得られない  
下記の様に紙おむつと自転車しかない大阪まで出てしまう
``` sql
SELECT * FROM Chapter6ShopItems
WHERE
	item IN(
		SELECT item FROM Chapter6Items)

-- result
shop	item
仙台	ビール
仙台	紙おむつ
仙台	自転車
東京	ビール
東京	紙おむつ
東京	自転車
大阪	紙おむつ
大阪	自転車
```
なのでGROUP BYで集合にして、その集合にHAVINGで条件を付ける
``` sql
SELECT s1.shop FROM Chapter6ShopItems as s1
INNER JOIN
	Chapter6Items as i
ON
	s1.item = i.item
GROUP BY
	s1.shop
HAVING
	COUNT(s1.item) = (SELECT COUNT(item) FROM Chapter6Items)

-- result
shop
仙台
東京
```

EX) 商品マスタの全商品をそろえ、かつそれ以外の商品がない店舗を選択する  
``` SQL
SELECT s1.shop FROM Chapter6ShopItems AS s1
LEFT JOIN
	Chapter6Items AS i1
ON
	s1.item = i1.item
GROUP BY
	s1.shop
HAVING
	COUNT(s1.item) = (SELECT COUNT(item) FROM Chapter6Items)
AND
	COUNT(i1.item) = (SELECT COUNT(item) FROM Chapter6Items)

-- result
shop
東京
```
- LEFT JOINで外部結合し、行数を落とさないようにする
- Chapter6Items(商品マスタ)の件数と比較
- COUNTがNULLを除外する仕様を使い、外部結合させた商品マスタと本来の商品マスタ数が一致するかを比較
