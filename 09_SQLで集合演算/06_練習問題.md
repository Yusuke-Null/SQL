# 練習問題
## 9-1
02_集合の相当性チェックで、UNIONだけを使う以下のクエリを使用した  
ただ、事前に行数を調べる必要があった  
Q. 事前に行数を調べることなく相当性チェックを行うように修正する
``` sql
SELECT COUNT(*) AS cnt FROM
(
	SELECT * FROM Chapter9Tbl_A
	UNION
	SELECT * FROM Chapter9Tbl_B
) AS tmp
```
2つのテーブルをUNIONした結果の行数が元の各テーブルと等しいかまでをクエリに組み込む  
-> 集約結果に対する条件設定が必要  
解答は以下だが、かなり強引できれいなやり方ではない
``` sql
SELECT
	CASE
		WHEN
			COUNT(*) = (SELECT COUNT(*) FROM Chapter9Tbl_A)
			AND
			COUNT(*) = (SELECT COUNT(*) FROM Chapter9Tbl_B)
		THEN '等しい'
		ELSE '異なる'
	END AS result
FROM
	(SELECT * FROM Chapter9Tbl_A
	 UNION
	 SELECT * FROM Chapter9Tbl_B) as tmp

-- result
result
等しい
```
## 9-2
| Chapter9EmpSkills |         |       |   | Chapter9Skills |       |
|------------------|---------|-------|---|----------------|-------|
| emp              | skill   |       |   | skill          |       |
| 相田             | Oracle  |       |   | Oracle         |       |
| 相田             | UNIX    |       |   | UNIX           |       |
| 相田             | Java    |       |   | Java           |       |
| 相田             | C#      |       |   |                |       |
| 神崎             | Oracle  |       |   |                |       |
| 神崎             | UNIX    |       |   |                |       |
| 神崎             | Java    |       |   |                |       |
| 平井             | UNIX    |       |   |                |       |
| 平井             | Oracle  |       |   |                |       |
| 平井             | PHP     |       |   |                |       |
| 平井             | Perl    |       |   |                |       |
| 平井             | C++     |       |   |                |       |
| 若田部           | Perl    |       |   |                |       |
| 渡来             | Oracle  |       |   |                |       |

03_差集合で関係除算を表現するで、上記のテーブルに対して以下のクエリを使用した  
このクエリでは相田はSkillsにないC#があってもSkills全ての技術があるので出力していた  
Q.Skillsと過不足がない厳密な除算をするように修正する(神崎だけ出力する)
``` sql
SELECT DISTINCT e1.emp
FROM Chapter9EmpSkills e1
WHERE
	NOT EXISTS
	(SELECT skill FROM Chapter9Skills AS s
	 EXCEPT
	 SELECT skill FROM Chapter9EmpSkills AS e2
	 WHERE
		e1.emp = e2.emp)

-- result
emp
神崎
相田
```
解答は以下のようになる
EmpSkills-Skillsが空集合であるだけでなく、Skills-EmpSkillsが空集合ことも条件に入れることで  
双方の集合が完全一致であることが保証される  
集合の相当性を調べる公式「(A ⊆ B)かつ(A ⊇ B)⇔(A = B) 」を利用している  
-> AがBを含み、かつBがAを含むなら両者は等しい
``` sql
SELECT DISTINCT e1.emp
FROM Chapter9EmpSkills e1
WHERE
	NOT EXISTS
	(SELECT skill FROM Chapter9Skills AS s1
	 EXCEPT
	 SELECT skill FROM Chapter9EmpSkills AS e2
	 WHERE
		e1.emp = e2.emp)
AND
	NOT EXISTS
	(SELECT skill FROM Chapter9EmpSkills e3
	 WHERE
		e1.emp = e3.emp
	 EXCEPT
	 SELECT skill FROM Chapter9Skills AS s2)
```
別解として社員の持つスキルを数える方法もある  
``` sql
SELECT emp FROM Chapter9EmpSkills AS e1
WHERE
	NOT EXISTS(
		SELECT skill FROM Chapter9Skills
		EXCEPT
		SELECT skill FROM Chapter9EmpSkills AS e2
		WHERE
			e1.emp = e2.emp)
GROUP BY
	emp
HAVING
	COUNT(*) = (SELECT COUNT(*) FROM Chapter9Skills)
```
